# Версия Node.js
FROM node:22.15.0

# Рабочая дирректория внутри контейнера Backend-части продукта Docker Compose
WORKDIR /nestbackend_kubagame_workspace/nx-monorepo/

# Копируем все файлы у которых наименование начинается на "package" и заканчивается типом файла ".json"
COPY ./nx-monorepo/package.json          ./package.json
COPY ./nx-monorepo/package-lock.json     ./package-lock.json
COPY ./nx-monorepo/.npmrc                ./.npmrc

# Устанавливаем NPM зависимости для работы Backend-части продукта
RUN npm install --verbose

# Копируем все остальные файлы
COPY ./nx-monorepo/ ./

# # Объявляем порт 3000 доступным для открытия внутри контейнера Backend-части продукта Docker Compose
EXPOSE 3000

# # Запускаем Backend-часть продукта внутри контейнера Docker Compose в режиме разработки и слежки за изменением файлов с кодом
CMD ["sh", "-c", "npm run backend:watch --verbose"]
